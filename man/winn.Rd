% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/winn.R
\name{winn}
\alias{winn}
\title{Winn Correction for Metabolomics Data}
\usage{
winn(
  data,
  plates = NULL,
  run_order = NULL,
  control_samples = NULL,
  parameters = "auto",
  fdr_threshold = 0.05,
  median_adjustment = "shrink",
  detrend_non_autocorrelated = "mean",
  remove_batch_effects = "anova",
  test = "Ljung-Box",
  lag = 20,
  scale_by_plate = FALSE
)
}
\arguments{
\item{data}{A numeric matrix or data frame where rows represent metabolites and columns represent samples.}

\item{plates}{An optional numeric vector indicating plate assignments for each sample. If NULL, segments will be auto-detected.}

\item{run_order}{An optional numeric vector representing the run order of samples.}

\item{control_samples}{An optional numeric vector representing the columns corresponding to control samples. If provided,
these will be used for normalization and parameter tuning.}

\item{parameters}{An optional character string specifying whether to use fixed ("fixed") or auto-detected ("auto") parameters in presence of control samples (default: "auto").}

\item{fdr_threshold}{A numeric value specifying the FDR threshold for drift and batch corrections (default: 0.05).}

\item{median_adjustment}{A character string specifying the method for median adjustment ("shrink", "normalize", or "none").}

\item{detrend_non_autocorrelated}{A character string specifying the method for detrending non-autocorrelated metabolites ("mean" or "spline").}

\item{remove_batch_effects}{A character string specifying the method for removing batch effects ("anova" or "combat").}

\item{test}{A character string specifying the autocorrelation test ("Ljung-Box" or "DW").}

\item{lag}{An integer specifying the lag for the autocorrelation test.}

\item{scale_by_plate}{Logical indicating whether to scale data by plate after corrections.}
}
\value{
A numeric matrix of corrected intensities.
}
\description{
This function performs a series of corrections on metabolomics data to adjust for dilution effects, outliers, drift, and batch effects.
If plate information is not supplied, segments are automatically detected using an fkPELT-based approach and labeled as plates.
}
\details{
The correction pipeline is as follows:
\enumerate{
  \item Median adjustment by dilution factor.
  \item Outlier adjustment using MAD.
  \item Drift correction using autocorrelation-based detrending.
  \item Batch effect correction using ANOVA-based residualization.
  \item Optional scaling by plate.
}

When control samples are provided, the function can also auto-detect the optimal parameter settings (for plate detection,
autocorrelation test type and FDR threshold, ANOVA FDR threshold, and scaling) by selecting the combination that maximizes
the mean correlation between control samples.
}
\examples{
your_data_matrix <- matrix(rnorm(200, mean = 100, sd = 15), nrow = 20)
plates <- rep(1:4, length.out = ncol(your_data_matrix))
run_order <- seq_len(ncol(your_data_matrix))
corrected_data <- winn(your_data_matrix, plates = plates, run_order = run_order)
}
